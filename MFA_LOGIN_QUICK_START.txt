# üîê MFA LOGIN - QUICK START

## ‚ö° FASTEST WAY TO TEST

### 1Ô∏è‚É£ Server Already Running?
```
http://localhost:8000
```

### 2Ô∏è‚É£ Go to Login Page
```
http://localhost:8000/login
```

### 3Ô∏è‚É£ Test Login (Existing User)

**Test Account:**
```
Email/Username: test@email.com
Password: password123
```

Or create new account via Register.

### 4Ô∏è‚É£ Enter Email & Password
- Click **LOGIN**
- PIN akan dikirim ke email

### 5Ô∏è‚É£ Check Email
- Buka inbox: **test@email.com**
- Cari kode 4-digit dari sistem
- Contoh: **1234**

### 6Ô∏è‚É£ Masuk PIN
- Di halaman verifikasi
- Enter kode 4-digit
- Click **VERIFIKASI SEKARANG**

### 7Ô∏è‚É£ Login Berhasil! ‚úì
- Redirect ke dashboard
- Akses semua fitur

---

## üîß CONFIGURATION (Optional)

### Change PIN Duration (Default: 10 min)

**File**: `app/Models/VerificationCode.php`

Find this line:
```php
public static function generate(
    string $email, 
    ?int $userId, 
    string $type, 
    int $digits = 4, 
    int $ttlMinutes = 10  // ‚Üê CHANGE THIS
): array
```

Change `10` to your desired minutes:
- `5` = 5 minutes (strict)
- `15` = 15 minutes (lenient)
- `30` = 30 minutes (very lenient)

### Change PIN Length (Default: 4 digits)

In same file, change:
```php
int $digits = 4  // ‚Üê CHANGE THIS
```

To:
- `6` = 6-digit code (more secure)
- `8` = 8-digit code (very secure)

**‚ö†Ô∏è Remember to update:**
- Input maxlength in view
- Test all values

---

## üìß EMAIL NOT WORKING?

### Check Mail Config

**File**: `.env`

```env
MAIL_MAILER=smtp
MAIL_HOST=your-smtp-host
MAIL_PORT=465
MAIL_USERNAME=your-username
MAIL_PASSWORD=your-password
MAIL_FROM_ADDRESS=your-email@domain.com
```

### Test Email Sending

```bash
php artisan tinker
```

Then run:
```php
Mail::to('your@email.com')->send(
    new App\Mail\VerificationPinMail('1234', 'login_mfa')
);
```

Should return `null` if success.

### Check Spam Folder
- Sometimes ends up in spam
- Add sender to contacts
- Check SMTP logs

---

## üß™ TEST CASES

### ‚úÖ Success Scenario
1. Login dengan valid credentials
2. PIN dikirim
3. Enter PIN yang benar
4. Login berhasil

### ‚ùå Error Scenarios

**Wrong PIN**
- Enter PIN salah
- Error: "Kode verifikasi salah"
- Try again dengan PIN benar

**Expired PIN** (>10 min)
- PIN sudah expired
- Error: "Kode sudah kadaluarsa"
- Must login again (new PIN)

**Max Attempts** (5x salah)
- Enter PIN salah 5x
- System blocks, must login again
- New PIN generated on next login

**Session Expired**
- Too long di PIN page
- Session expired
- Redirect to login

---

## üìä FILES MODIFIED

```
‚úÖ app/Http/Controllers/AuthController.php
   ‚îî‚îÄ Added: login(), showLoginVerifyPin(), verifyLoginPin()

‚úÖ routes/web.php
   ‚îî‚îÄ Added: /login/verify-pin routes

‚úÖ app/Http/Controllers/VerificationController.php
   ‚îî‚îÄ Updated: Support for 'login_mfa' type

‚úÖ app/Models/VerificationCode.php
   ‚îî‚îÄ Added: TYPE_LOGIN_MFA constant

‚ú® resources/views/auth/verify-login-pin.blade.php
   ‚îî‚îÄ New: PIN verification page
```

---

## üéØ FLOW (In Seconds)

```
Login Page
    ‚Üì (email + password)
AuthController::login()
    ‚Üì (if password valid)
Generate PIN + Email
    ‚Üì
PIN Verification Page
    ‚Üì (enter PIN)
AuthController::verifyLoginPin()
    ‚Üì (if PIN valid)
Login User
    ‚Üì
Home Page ‚úì
```

---

## üîí SECURITY FACTS

- ‚úÖ PIN hashed dengan bcrypt (not plain text)
- ‚úÖ PIN 10 menit expiry (automatically invalidates)
- ‚úÖ PIN one-time use (consumed after verify)
- ‚úÖ Max 5 attempts (prevents brute force)
- ‚úÖ Email required (additional verification factor)
- ‚úÖ Session isolated (login_attempt separate)

---

## üí° TIPS

### Remember Me Functionality
```
‚úì Check "Remember Me" saat login
‚úì Browser akan save token (30 days)
‚úì Next visit: No need to login
‚úì Just works automatically
```

### Multiple Devices
```
‚úì Each device = new PIN needed
‚úì Previous PIN invalid on other device
‚úì Security benefit: Session per device
```

### Test Without Email
For development only - modify `AuthController::login()`:
```php
// Comment out email sending temporarily
// Mail::to($user->email)->send(...);

// Log PIN instead
Log::info('Test PIN: ' . $pin);
```

---

## ‚ö†Ô∏è COMMON ISSUES

| Issue | Solution |
|-------|----------|
| PIN not received | Check spam, verify SMTP config |
| Page stuck at PIN | Clear browser cache, try new incognito |
| PIN always "expired" | Check server time, timezone settings |
| Remember Me not working | Check SESSION_DRIVER in .env |
| Error: "Session expired" | TTL too short, increase $ttlMinutes |

---

## üöÄ NEXT STEPS

1. **Test thoroughly** - Try all scenarios
2. **Customize** - Change colors, text if needed
3. **Deploy** - Push to production
4. **Monitor** - Watch logs for errors
5. **Feedback** - Collect user feedback

---

## üìö FULL DOCUMENTATION

For detailed information, see:
- `MFA_LOGIN_DOCUMENTATION.md` - Complete guide

---

**Need Help?**
- Check MFA_LOGIN_DOCUMENTATION.md for troubleshooting
- Review code comments in AuthController
- Check Laravel docs for Authentication

---

**Status**: ‚úÖ READY TO USE  
**Last Updated**: Dec 15, 2025
